/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package Tracker;

import java.io.*;
import java.util.HashMap;

import com.google.gson.JsonIOException;
import com.google.gson.JsonSyntaxException;

import Tracker.Infrastructure.HttpServer.Server;
import Tracker.Infrastructure.ToyDatabaseServer.DatabaseConnection.DatabaseConnectionManager;

public class App {
    public String getGreeting() {
        return "Hello World!";
    }

	// MAKE SURE YOU CHANGE THIS TO PATH 
	private static final String DATABASE = "/Users/armeenrashidian/Documents/cpsc557/Tracker/app/src/main/resources/Database.txt";

    public static void main(String[] args) {
        HashMap<String, String> params = parseCommandLine(args);
        int serverPort = Integer.parseInt( params.getOrDefault("-p", "2025") ); // server port number
        System.out.println("starting the server on port " + serverPort);
        Server server = new Server(serverPort);
		// initialize database
		try {
			DatabaseConnectionManager.initialize(DATABASE);
		} catch (JsonIOException | JsonSyntaxException | FileNotFoundException e) {
			// TODO Auto-generated catch block
			System.out.println("Can't connect to database");
			e.printStackTrace();
		}
		server.listen();
    }

    	// parse command line arguments
	private static HashMap<String, String> parseCommandLine(String[] args) {
		HashMap<String, String> params = new HashMap<String, String>();

		int i = 0;
		while ((i + 1) < args.length) {
			params.put(args[i], args[i+1]);
			i += 2;
		}
		
		return params;
	}
}
